---
/**
 * TriedBeforeSection Component
 *
 * @description Section about trying to understand yourself before
 */

import { Icon } from 'astro-icon/components'
import { getTranslationsFromUrl, getTranslation } from '../utils/useTranslation.js'

interface Props {
  class?: string
}

const { class: className } = Astro.props

// Get translations for current language
const translations = await getTranslationsFromUrl(Astro.url.pathname)
const t = (key: string, fallback = '') => {
  return getTranslation(translations, key, {}, fallback)
}

type TriedBeforeTranslations = { triedBefore?: { testimonials?: Array<{ quote: string; author: string }> } }
const testimonials: Array<{ quote: string; author: string }> = Array.isArray(
  (translations as unknown as TriedBeforeTranslations)?.triedBefore?.testimonials
)
  ? ((translations as unknown as TriedBeforeTranslations).triedBefore!.testimonials as Array<{
      quote: string
      author: string
    }>)
  : []
---

<section
  class:list={[className, 'bg-gradient-to-br from-gray-50 to-purple-50/30 py-20']}
  aria-labelledby="tried-before-headline"
>
  <div class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8">
    <!-- Header -->
    <div class="mb-12 text-center">
      <h2 id="tried-before-headline" class="mb-6 text-3xl font-bold text-gray-900 sm:text-4xl">
        {t('triedBefore.headline', "You've Tried to Understand Yourself Before")}
      </h2>
      <p class="mx-auto max-w-3xl text-lg leading-relaxed text-gray-600">
        {
          t(
            'triedBefore.intro',
            "You've explored ideas like attachment styles, communication habits, and love languages. They made sense in theory — but it's harder to see how they show up in real moments."
          )
        }
      </p>
    </div>

    <!-- Main content -->
    <div class="mx-auto max-w-4xl space-y-8">
      <!-- Key insight -->
      <div class="text-center">
        <p class="font-heading mb-6 text-xl font-semibold text-gray-900 sm:text-2xl">
          {t('triedBefore.insight', "What you've been missing is a reflection that speaks your language.")}
        </p>
        <p class="mx-auto max-w-2xl text-lg leading-relaxed text-gray-700">
          {
            t(
              'triedBefore.description',
              "Withinly turns psychological ideas into something familiar and specific — moments you'll recognize from your own patterns."
            )
          }
        </p>
      </div>

      <!-- Testimonials -->
      {
        testimonials.length > 0 && (
          <div class="grid gap-8 md:grid-cols-2">
            {testimonials.map((testimonial) => (
              <blockquote class="group relative rounded-2xl border border-gray-200 bg-white p-8 shadow-sm transition-shadow duration-300 hover:shadow-md">
                <div class="mb-4">
                  <Icon name="lucide:quote" class="mb-3 h-6 w-6 text-purple-200" />
                  <p class="text-base leading-relaxed text-gray-700 italic sm:text-lg">"{testimonial.quote}"</p>
                </div>
                <footer class="text-sm font-medium text-gray-600">— {testimonial.author}</footer>
              </blockquote>
            ))}
          </div>
        )
      }
    </div>
  </div>
</section>

<style lang="scss">
  @use '../assets/scss/base/breakpoint' as *;

  // Enhanced gradient background
  .bg-gradient-to-br {
    position: relative;

    &::before {
      position: absolute;
      top: 0;
      right: 0;
      bottom: 0;
      left: 0;
      background:
        radial-gradient(circle at 30% 20%, rgba(168, 85, 247, 0.03) 0%, transparent 50%),
        radial-gradient(circle at 70% 80%, rgba(147, 51, 234, 0.03) 0%, transparent 50%);
      pointer-events: none;
      content: '';
    }
  }

  // Accessibility improvements
  h2:focus {
    outline: 2px solid var(--color-primary-500);
    outline-offset: 4px;
    border-radius: var(--radius-s);
  }

  // Smooth transitions
  * {
    transition-duration: 150ms;
    transition-property:
      color, background-color, border-color, text-decoration-color, fill, stroke, opacity, box-shadow, transform,
      filter, backdrop-filter;
    transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1);
  }

  // Accessibility improvements
  @media (prefers-reduced-motion: reduce) {
    * {
      transition: none;
    }
  }
</style>
